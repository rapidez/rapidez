services:
  # Set up the elasticsearch installation.
  elasticsearch:
    extends:
      file: .docker/compose/elasticsearch.yml
      service: elasticsearch
    ports:
      - 127.0.0.1:9200:9200

  # The full Magento installation for demo purposes including Nginx, php-fpm, mysql, elasticsearch.
  # Once you start linking your own installation you should probably comment this out
  # and replace it with a real Mysql and Magento installation
  magento:
    extends:
      file: .docker/compose/magento-sample.yml
      service: magento
    ports:
      - 127.0.0.1:${MAGENTO_PORT:-1234}:80
      - 127.0.0.1:${DB_PORT}:3306

  # Send rapidez requests to the php-fpm installation within the Rapidez container.
  rapidez:
    extends:
      file: .docker/compose/rapidez.yml
      service: rapidez

  # The actual Rapidez installation + php-fpm.
  nginx:
    extends:
      file: .docker/compose/rapidez.yml
      service: nginx
    ports:
      - 127.0.0.1:${RAPIDEZ_PORT:-1235}:80

volumes:
  magento-www:
